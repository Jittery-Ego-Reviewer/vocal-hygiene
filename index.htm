<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=2.0">
    <title>Ë≠∑ËÅ≤Â∞èÂçöÂ£´</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            overflow-x: hidden;
            overflow-y: auto;
            font-family: 'PingFang HK', 'Microsoft JhengHei', sans-serif;
            background: linear-gradient(to bottom, #87CEEB 0%, #E0F7FA 100%);
            min-height: 100vh;
            margin: 0;
            padding-bottom: 40px;
        }

        .game-container {
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px 0;
            box-sizing: border-box;
        }

        header {
            margin-bottom: 30px;
            z-index: 10;
        }

        #apple-field {
            width: 95vw;
            max-width: 600px;
            min-height: 450px; /* Space for scattered apples */
            position: relative;
            margin-bottom: 20px;
        }

        .apple {
            position: absolute;
            width: 85px; /* Much larger apples */
            height: 85px;
            cursor: grab;
            user-select: none;
            z-index: 20;
            display: flex;
            align-items: center;
            justify-content: center;
            filter: drop-shadow(0 6px 8px rgba(0,0,0,0.2));
            touch-action: none;
            transition: transform 0.2s ease;
        }

        .apple-body {
            position: absolute;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at 30% 30%, #ff5f5f, #cc0000);
            border-radius: 50% 50% 46% 46%;
            box-shadow: inset -5px -5px 10px rgba(0,0,0,0.3);
        }

        .apple-leaf {
            position: absolute;
            top: -6px;
            left: 55%;
            width: 18px;
            height: 24px;
            background: #2e7d32;
            border-radius: 0 100% 0 100%;
            transform: translateX(-50%) rotate(-10deg);
        }

        .apple-text {
            position: relative;
            z-index: 21;
            color: white;
            font-weight: 900;
            font-size: 16px; /* Larger, bolder font */
            text-align: center;
            padding: 5px;
            line-height: 1.2;
            pointer-events: none;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .apple.revealed .apple-text {
            opacity: 1;
        }

        .basket-container {
            width: 100%;
            display: flex;
            justify-content: space-evenly;
            padding: 20px 10px;
            margin-top: 10px;
            z-index: 5;
            flex-shrink: 0;
        }

        .basket {
            width: 44vw;
            max-width: 170px;
            height: 110px;
            border-radius: 15px 15px 45% 45%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 800;
            box-shadow: 0 8px 16px rgba(0,0,0,0.25);
            border: 4px solid rgba(255,255,255,0.5);
        }

        #good-basket { background: #2E7D32; }
        #bad-basket { background: #C62828; }

        .dragging {
            z-index: 1000 !important;
            cursor: grabbing;
            transform: scale(1.2);
        }

        .success-msg {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 35px;
            border-radius: 30px;
            box-shadow: 0 25px 60px rgba(0,0,0,0.5);
            text-align: center;
            display: none;
            z-index: 2000;
            width: 85%;
            max-width: 450px;
        }

        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            z-index: 1999;
        }
    </style>
</head>
<body>

<div class="game-container">
    <header class="text-center px-4">
        <h1 class="text-3xl font-bold text-green-900 drop-shadow-sm">üçé Ë≠∑ËÅ≤Â∞èÂçöÂ£´</h1>
        <p class="text-lg text-blue-800 font-bold mt-1">ÊääËòãÊûúÊãñÂà∞Ê≠£Á¢∫ÁöÑÁ±ÉÂ≠êÔºÅ</p>
    </header>

    <div id="apple-field">
        <!-- Scattered apples go here -->
    </div>

    <div class="basket-container">
        <div id="good-basket" class="basket">
            <span class="text-2xl">Â•ΩÁøíÊÖ£</span>
        </div>

        <div id="bad-basket" class="basket">
            <span class="text-2xl">Â£ûÁøíÊÖ£</span>
        </div>
    </div>

    <div id="success-modal" class="success-msg">
        <h2 class="text-3xl font-bold mb-4 text-green-600">üåü ÊÅ≠ÂñúÔºÅ</h2>
        <p class="text-xl mb-8">‰Ω†Â≠∏ÊúÉ‰∫Ü‰øùË≠∑ËÅ≤Â∏∂ÁöÑÂ•ΩÁøíÊÖ£ÔºÅ</p>
        <button onclick="location.reload()" class="bg-blue-600 text-white px-12 py-4 rounded-full font-bold text-2xl hover:bg-blue-700 shadow-xl transition-all active:scale-95">ÂÜçÁé©‰∏ÄÊ¨°</button>
    </div>
</div>

<script>
    const habits = [
        { text: "ÊÖ¢ÊÖ¢Ë™¨Ë©±", good: true },
        { text: "Â§öÂñùÊ∞¥", good: true },
        { text: "ËºïËÅ≤Ë™¨Ë©±", good: true },
        { text: "Áù°Ë¶∫‰ºëÊÅØ", good: true },
        { text: "Áî®ÈºªÂ≠êÂëºÂê∏", good: true },
        { text: "Â∞ñÂè´", good: false },
        { text: "Â§ßÂè´", good: false },
        { text: "‰∏çÂñùÊ∞¥", good: false },
        { text: "‰∏çÂÅúË™¨Ë©±", good: false },
        { text: "Â§ßÂì≠", good: false },
        { text: "Áî®Âè£ÂëºÂê∏", good: false },
        { text: "Á∂ìÂ∏∏ÂêÉÁÖéÁÇ∏È£üÁâ©", good: false },
        { text: "Á∂ìÂ∏∏ÂêÉËæõËæ£È£üÁâ©", good: false }
    ];

    const appleField = document.getElementById('apple-field');
    const goodBasket = document.getElementById('good-basket');
    const badBasket = document.getElementById('bad-basket');
    let applesRemaining = habits.length;

    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    function playCorrectSound() {
        if (audioCtx.state === 'suspended') audioCtx.resume();
        const oscillator = audioCtx.createOscillator();
        const gainNode = audioCtx.createGain();
        oscillator.connect(gainNode);
        gainNode.connect(audioCtx.destination);
        oscillator.type = 'sine';
        oscillator.frequency.setValueAtTime(523.25, audioCtx.currentTime);
        oscillator.frequency.exponentialRampToValueAtTime(880, audioCtx.currentTime + 0.1);
        gainNode.gain.setValueAtTime(0.1, audioCtx.currentTime);
        gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.3);
        oscillator.start();
        oscillator.stop(audioCtx.currentTime + 0.3);
    }

    function initApples() {
        const fieldWidth = appleField.clientWidth;
        const fieldHeight = appleField.clientHeight;
        const appleSize = 85;
        const shuffledHabits = [...habits].sort(() => Math.random() - 0.5);

        // Simple grid-based scattering to prevent too much overlap while keeping it "scattered"
        const cols = 3;
        const rows = Math.ceil(shuffledHabits.length / cols);
        const cellWidth = fieldWidth / cols;
        const cellHeight = fieldHeight / rows;

        shuffledHabits.forEach((habit, index) => {
            const apple = document.createElement('div');
            apple.className = 'apple';
            apple.dataset.good = habit.good;
            
            const col = index % cols;
            const row = Math.floor(index / cols);
            
            // Base position in grid cell
            let x = (col * cellWidth) + (cellWidth / 2) - (appleSize / 2);
            let y = (row * cellHeight) + (cellHeight / 2) - (appleSize / 2);

            // Add significant randomness
            x += (Math.random() - 0.5) * (cellWidth * 0.6);
            y += (Math.random() - 0.5) * (cellHeight * 0.6);

            // Keep within bounds
            x = Math.max(5, Math.min(x, fieldWidth - appleSize - 5));
            y = Math.max(5, Math.min(y, fieldHeight - appleSize - 5));
            
            apple.style.left = `${x}px`;
            apple.style.top = `${y}px`;
            apple.dataset.origX = x;
            apple.dataset.origY = y;
            
            apple.innerHTML = `
                <div class="apple-body"></div>
                <div class="apple-leaf"></div>
                <div class="apple-text">${habit.text}</div>
            `;
            
            setupDraggable(apple);
            appleField.appendChild(apple);
        });
    }

    function setupDraggable(el) {
        let startX, startY, initialLeft, initialTop;
        let isDragging = false;

        const onStart = (e) => {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            
            el.classList.add('revealed');
            isDragging = true;
            el.classList.add('dragging');

            const clientX = e.type.includes('touch') ? e.touches[0].clientX : e.clientX;
            const clientY = e.type.includes('touch') ? e.touches[0].clientY : e.clientY;
            
            const rect = el.getBoundingClientRect();
            startX = clientX;
            startY = clientY;
            initialLeft = rect.left;
            initialTop = rect.top;

            el.style.position = 'fixed';
            el.style.left = `${initialLeft}px`;
            el.style.top = `${initialTop}px`;
            el.style.width = '85px';
            el.style.height = '85px';
            document.body.appendChild(el);
        };

        const onMove = (e) => {
            if (!isDragging) return;
            if (e.cancelable) e.preventDefault();
            
            const clientX = e.type.includes('touch') ? e.touches[0].clientX : e.clientX;
            const clientY = e.type.includes('touch') ? e.touches[0].clientY : e.clientY;
            
            const dx = clientX - startX;
            const dy = clientY - startY;
            
            el.style.left = `${initialLeft + dx}px`;
            el.style.top = `${initialTop + dy}px`;
        };

        const onEnd = (e) => {
            if (!isDragging) return;
            isDragging = false;
            el.classList.remove('dragging');
            
            const rect = el.getBoundingClientRect();
            const appleCenterX = rect.left + rect.width / 2;
            const appleCenterY = rect.top + rect.height / 2;
            
            const goodRect = goodBasket.getBoundingClientRect();
            const badRect = badBasket.getBoundingClientRect();
            const isGood = el.dataset.good === "true";

            if (isPointInRect(appleCenterX, appleCenterY, goodRect)) {
                if (isGood) handleSuccess(el);
                else returnToOriginalPos(el);
            } 
            else if (isPointInRect(appleCenterX, appleCenterY, badRect)) {
                if (!isGood) handleSuccess(el);
                else returnToOriginalPos(el);
            } else {
                returnToOriginalPos(el);
            }
        };

        el.addEventListener('mousedown', onStart);
        el.addEventListener('touchstart', onStart, { passive: false });
        window.addEventListener('mousemove', onMove, { passive: false });
        window.addEventListener('touchmove', onMove, { passive: false });
        window.addEventListener('mouseup', onEnd);
        window.addEventListener('touchend', onEnd);
    }

    function handleSuccess(el) {
        playCorrectSound();
        el.style.transition = "transform 0.4s ease-in, opacity 0.4s";
        el.style.transform = "scale(0) rotate(90deg)";
        el.style.opacity = "0";
        setTimeout(() => {
            el.remove();
            applesRemaining--;
            if (applesRemaining === 0) showSuccess();
        }, 400);
    }

    function returnToOriginalPos(el) {
        el.style.transition = "all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275)";
        
        const fieldRect = appleField.getBoundingClientRect();
        const targetX = fieldRect.left + parseFloat(el.dataset.origX);
        const targetY = fieldRect.top + parseFloat(el.dataset.origY);
        
        el.style.left = `${targetX}px`;
        el.style.top = `${targetY}px`;
        
        setTimeout(() => {
            el.style.transition = "";
            el.classList.remove('revealed');
            el.style.position = 'absolute';
            el.style.left = `${el.dataset.origX}px`;
            el.style.top = `${el.dataset.origY}px`;
            appleField.appendChild(el);
        }, 500);
    }

    function isPointInRect(x, y, rect) {
        return x >= rect.left && x <= rect.right && y >= rect.top && y <= rect.bottom;
    }

    function showSuccess() {
        document.getElementById('success-modal').style.display = 'block';
        createConfetti();
    }

    function createConfetti() {
        for (let i = 0; i < 60; i++) {
            const confetti = document.createElement('div');
            confetti.className = 'confetti';
            confetti.style.left = Math.random() * 100 + 'vw';
            confetti.style.top = '-10px';
            confetti.style.backgroundColor = `hsl(${Math.random() * 360}, 85%, 60%)`;
            document.body.appendChild(confetti);

            confetti.animate([
                { transform: `translate3d(0,0,0) rotate(0)`, opacity: 1 },
                { transform: `translate3d(${(Math.random() - 0.5) * 400}px, 100vh, 0) rotate(${Math.random() * 1000}deg)`, opacity: 0 }
            ], {
                duration: 2000 + Math.random() * 2500,
                easing: 'ease-out'
            }).onfinish = () => confetti.remove();
        }
    }

    window.addEventListener('load', initApples);
</script>

</body>
</html>
